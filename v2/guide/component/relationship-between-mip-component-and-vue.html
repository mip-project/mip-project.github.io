<!DOCTYPE html>
<html mip>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
    <title>MIP 文档_移动网页加速器_MIP(Mobile Instant Pages_)MIP 组件和 Vue 的关系</title>
    <meta name="description" content="MIP 组件化的核心是基于 Custom Elements（自定义元素）来实现的。Custom Elements 可以让浏览器识别我们自定义的 HTML 标签，并将我们预先定义的标签内容和结构在网页中渲染出来。Custom Elements 目前已经被纳入 W3C DOM 标准，MIP 采用的是 Custom Elements V1 规范，但考虑到目前并不是所有的浏览器都完全支持该标准，MIP 引入了相关的 polyfill 来兼容暂时不支持 Custom Elements 标准的浏览器。">
    <link rel="canonical" href="/v2/guide/component/relationship-between-mip-component-and-vue.html">
    <link rel="stylesheet" type="text/css" href="https://c.mipcdn.com/static/v2/mip.css">
    <link rel="icon" href="https://www.mipengine.org/favicon.ico">
    <!-- <link rel="stylesheet" href="https://bos.nj.bpc.baidu.com/assets/mip/projects/mip.css"> -->
    <!-- <link rel="stylesheet" href="http://172.18.19.102:8080/dist/mip.css"> -->
    <link rel="stylesheet" type="text/css" href="/src/style/dist/index.css">
  </head>
  <body>
<mip-fixed type="top" class="layout-navbar-fixed">
  <div class="layout-navbar">
    <a data-type="mip" href="/"><div class="navbar-logo"></div></a>
    <div class="navbar-menu">
      <ul class="navbar-menu-wrapper">
        <li class="navbar-item" ><a data-type="mip" href="/v2/index.html" class="menu-name" title="首页">首页</a></li>
        <li class="navbar-item active">
          <span class="menu-name" title="学习">学习<i class="arrow"></i></span>
          <ul class="navbar-sub-menu">
            <li class="navbar-sub-item"><a data-type="mip" href="/v2/guide/basic/newbie.html" title="使用文档">使用文档</a></li>
            <li class="navbar-sub-item"><a data-type="mip" href="/v2/components/index.html" title="组件列表">组件列表</a></li>
            <li class="navbar-sub-item"><a data-type="mip" href="/v2/api/index.html" title="API">API</a></li>
            <li class="navbar-sub-item"><a data-type="mip" href="/v2/codelabs/index.html" title="Codelab">Codelab</a></li>
          </ul>
        </li>
        <li class="navbar-item">
          <span class="menu-name" title="常用链接">常用链接<i class="arrow"></i></span>
          <ul class="navbar-sub-menu">
            <li class="navbar-sub-item"><a data-type="mip" href="http://www.cnblogs.com/mipengine" title="MIP 官方博客">MIP 官方博客</a></li>
            <li class="navbar-sub-item"><a data-type="mip" href="https://github.com/mipengine/mip2/tree/master/packages/mip-cli" title="MIP-CLI 本地开发工具">MIP-CLI 本地开发工具</a></li>
            <li class="navbar-sub-item"><a data-type="mip" href="https://www.mipengine.org/validator/validate" title="MIP 代码校验工具">MIP 代码校验工具</a></li>
            <li class="navbar-sub-item"><a data-type="mip" href="https://www.mipengine.org/validator/preview" title="MIP 效果预览工具">MIP 效果预览工具</a></li>
            <li class="navbar-sub-item"><a data-type="mip" href="https://www.mipengine.org/mippath.html" title="MIP PATH 转换工具">MIP PATH 转换工具</a></li>
          </ul>
        </li>
        <li class="navbar-item" ><a target="_blank" href="https://github.com/mipengine/mip2" class="menu-name" title="GitHub">GitHub</a></li>
        <li class="navbar-item" ><a target="_blank" href="https://www.mipengine.org" class="menu-name" title="回到旧版">回到旧版</a></li>
      </ul>
      <div class="navbar-indicator" m-bind:style="navbarStyle"></div>
    </div>
    <div class="navbar-toggle" on="tap:nav-sidebar.open"><i class="iconfont icon-bars"></i></div>
  </div>
</mip-fixed>

    <mip-sidebar
      id="nav-sidebar"
      layout="nodisplay"
      side="right"
      class="mip-hidden nav-sidebar"
    >
<div class="sidebar-fragment sidebar-nav-wrapper"
  m-bind:class="{hide:sidebarFragment!=='nav'}"
>
  <h1 on="tap:MIP.setData({sidebarFragment:m.sidebarSecondFragment})"><span class="home-arrow">目录</span></h1>
  <ul class="navbar-menu-wrapper">
    <li class="navbar-item" ><a data-type="mip" href="/v2/index.html" class="menu-name">首页</a></li>
    <li class="navbar-item active">
      <span class="menu-name">学习</span>
      <ul class="navbar-sub-menu">
        <li class="navbar-sub-item"><a data-type="mip" href="/v2/guide/basic/newbie.html">使用文档</a></li>
        <li class="navbar-sub-item"><a data-type="mip" href="/v2/components/index.html">组件列表</a></li>
        <li class="navbar-sub-item"><a data-type="mip" href="/v2/api/index.html">API</a></li>
        <li class="navbar-sub-item"><a data-type="mip" href="/v2/codelabs/index.html">Codelab</a></li>
      </ul>
    </li>
    <li class="navbar-item">
      <span class="menu-name">常用链接</span>
      <ul class="navbar-sub-menu">
        <li class="navbar-sub-item"><a data-type="mip" href="http://www.cnblogs.com/mipengine">MIP 官方博客</a></li>
        <li class="navbar-sub-item"><a data-type="mip" href="https://github.com/mipengine/mip2/tree/master/packages/mip-cli">MIP-CLI 本地开发工具</a></li>
        <li class="navbar-sub-item"><a data-type="mip" href="https://www.mipengine.org/validator/validate">MIP 代码校验工具</a></li>
        <li class="navbar-sub-item"><a data-type="mip" href="https://www.mipengine.org/validator/preview">MIP 效果预览工具</a></li>
        <li class="navbar-sub-item"><a data-type="mip" href="https://www.mipengine.org/mippath.html">MIP PATH 转换工具</a></li>
      </ul>
    </li>
    <li class="navbar-item" ><a data-type="mip" href="https://github.com/mipengine/mip2" class="menu-name">GitHub</a></li>
    <li class="navbar-item" ><a data-type="mip" href="https://www.mipengine.org" class="menu-name">回到旧版</a></li>
  </ul>
</div>
<div class="sidebar-fragment navbar-secnav-wrapper"
  m-bind:class="{hide:sidebarFragment!=='guide'}"
>
  <h1 on="tap:MIP.setData({sidebarFragment:'nav'})"><span>使用文档</span></h1>
  <mip-sidenav m-bind:menu="menu" m-bind:chapters="chapters" m-bind:url="url"></mip-sidenav>
</div>
    </mip-sidebar>

<mip-fixed type="left" top="64px" class="layout-sidebar">
  <mip-sidenav m-bind:menu="menu" m-bind:chapters="chapters" m-bind:url="url">
  </mip-sidenav>
</mip-fixed>
<div class="layout-main-content">
  <div class="content-wrapper">
<p class="markdown-breadcrumb">
  <span>MIP 组件机制</span><span class="split">/</span>  <span>MIP 组件和 Vue 的关系</span></p>
    <div class="markdown-body">
      <h1 id="mip-组件和-vue-的关系"><a href="#mip-组件和-vue-的关系" class="heading-link"><i class="fa fa-link" aria-hidden="true"></i></a>MIP 组件和 Vue 的关系</h1><p>MIP 组件化的核心是基于 Custom Elements（自定义元素）来实现的。Custom Elements 可以让浏览器识别我们自定义的 HTML 标签，并将我们预先定义的标签内容和结构在网页中渲染出来。Custom Elements 目前已经被纳入 W3C DOM 标准，MIP 采用的是 Custom Elements V1 规范，但考虑到目前并不是所有的浏览器都完全支持该标准，MIP 引入了相关的 <a data-type="mip" href="https://github.com/WebReflection/document-register-element">polyfill</a> 来兼容暂时不支持 Custom Elements 标准的浏览器。</p><h2 id="定义自定义元素"><a href="#定义自定义元素" class="heading-link"><i class="fa fa-link" aria-hidden="true"></i></a>定义自定义元素</h2><p>如果浏览器支持 Custom Elements 标准，在 window 下就会有 customElements 对象，customElements 对象含有一个 <code>define()</code> 方法用来注册和定义一个 HTML 自定义元素，下面我们展示一段用来创建自定义元素的 JS 代码：</p><pre><div class="code-index"><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div></div><code class="lang-js"><span class="hljs-built_in">window</span>.customElements.define(<span class="hljs-string">'custom-drawer'</span>, <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HTMLElement</span> </span>{
  connectedCallback() {
    <span class="hljs-keyword">this</span>.innerHTML = <span class="hljs-string">'&lt;p&gt;Hello world.&lt;/p&gt;'</span>
  }
});</code></pre><p><code>define</code> 方法接收两个参数，第一个参数为需要创建的 HTML 自定义元素的名称，第二个参数为一个继承 <code>HTMLElement</code> 的类，通过重写 <code>HTMLElement</code> 的一些方法，就可以定制 HTML 自定义元素的内容，从而可以完全的从新创造一个自定义的 HTML 元素。</p><p>如果我们像上面的 JS 代码一样通过 <code>window.customElements.define()</code> 方法注册了一个名为 <code>custom-drawer</code> 的自定义元素，那对应的 HTML 自定义标签为 <code>&lt;custom-drawer&gt;</code>，在 HTML 文档中就可以直接像下面这样使用新的 HTML 自定义标签：</p><pre><div class="code-index"><div>1</div><div>2</div><div>3</div><div>4</div></div><code class="lang-html"><span class="hljs-comment">&lt;!-- index.html --&gt;</span>
  <span class="hljs-comment">&lt;!-- 在使用的时候并没有指定 custom-drawer 的内容 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">custom-drawer</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">custom-drawer</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre><p>HTML 文档通过浏览器的渲染，最终在浏览器渲染后的 DOM 结构如下所示：</p><pre><div class="code-index"><div>1</div><div>2</div><div>3</div><div>4</div></div><code class="lang-html"><span class="hljs-comment">&lt;!-- 渲染之后 custom-drawer 就包含了内容 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">custom-drawer</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Hello world.<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">custom-drawer</span>&gt;</span></code></pre><p>我们可以发现自定义标签 <code>&lt;custom-drawer&gt;</code> 被渲染出来了，并且我们在 JS 中定义的 <code>this.innerHTML</code> 的内容也被渲染在自定义元素 <code>&lt;custom-drawer&gt;</code> 的内部。</p><h2 id="mip-组件"><a href="#mip-组件" class="heading-link"><i class="fa fa-link" aria-hidden="true"></i></a>MIP 组件</h2><p>MIP 组件和 Custom Elements 是密不可分的，接下来我们看下 MIP 是如何利用 Custom Elements 实现 MIP 组件的，MIP 暴露了一个注册 MIP 组件的方法 <code>MIP.registerCustomElement()</code> 用来注册 MIP 组件，调用方式如下：</p><pre><div class="code-index"><div>1</div></div><code class="lang-js">MIP.registerCustomElement(<span class="hljs-string">'mip-drawer'</span>, CustomElementClass, css)</code></pre><p>和前面小节讲到的 <code>window.customElements.define</code> 方法用法类似，只是 <code>MIP.registerCustomElement</code> 接收三个参数，第一个参数也是指定一个 MIP 标签的名称，MIP 组件名称都是要求以 <code>mip-</code> 开头，第二个参数为也是一个继承于 <code>HTMLElement</code> 的类，第三个参数可选，为 CSS 代码字符串，可以给 MIP 组件通过注册的时候指定默认 CSS 样式。</p><p><code>MIP.registerCustomElement()</code> 方法精简后的代码实现大体如下：</p><pre><div class="code-index"><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div><div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div><div>31</div><div>32</div><div>33</div><div>34</div><div>35</div><div>36</div><div>37</div><div>38</div><div>39</div><div>40</div><div>41</div><div>42</div><div>43</div><div>44</div><div>45</div><div>46</div><div>47</div></div><code class="lang-js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseElement</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HTMLElement</span> </span>{
  <span class="hljs-keyword">constructor</span> (element) {
    <span class="hljs-keyword">super</span>(element)

    <span class="hljs-keyword">let</span> CustomElement = customElementsStore.get(<span class="hljs-keyword">this</span>.tagName.toLowerCase(), <span class="hljs-string">'mip2'</span>)
    <span class="hljs-keyword">let</span> customElement = <span class="hljs-keyword">this</span>.customElement = <span class="hljs-keyword">new</span> CustomElement(<span class="hljs-keyword">this</span>)
  }

  connectedCallback () {
    <span class="hljs-keyword">this</span>.customElement.connectedCallback()
  }

  disconnectedCallback () {
    <span class="hljs-keyword">this</span>.customElement.disconnectedCallback()
  }

  attributeChangedCallback () {
    <span class="hljs-keyword">this</span>.customElement.attributeChangedCallback.apply(ele, <span class="hljs-built_in">arguments</span>)
  }
  <span class="hljs-comment">// 渲染自定义元素内部结构</span>
  build () {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isBuilt()) {
      <span class="hljs-keyword">return</span>
    }
    <span class="hljs-keyword">this</span>.customElement.build()
    <span class="hljs-keyword">this</span>._built = <span class="hljs-literal">true</span>
  }

  isBuilt () {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._built
  }
}

MIP.registerCustomElement = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, CustomElementClass, css</span>) </span>{
  <span class="hljs-comment">// 检查是否已注册过该自定义元素，避免重复注册</span>
  <span class="hljs-keyword">if</span> (customElementsStore.get(name)) {
    <span class="hljs-keyword">return</span>
  }
  customElementsStore.set(name, CustomElementClass, <span class="hljs-string">'mip2'</span>)
  <span class="hljs-comment">// 定义自定义元素</span>
  <span class="hljs-built_in">window</span>.customElements.define(name, <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseElement</span> </span>{
    <span class="hljs-comment">// 显式声明需要监听自定义元素属性变化的属性名</span>
    <span class="hljs-keyword">static</span> get observedAttributes () {
      <span class="hljs-keyword">return</span> CustomElementClass.observedAttributes
    }
  })
}</code></pre><p>由于 MIP 组件有些公共的逻辑要在生命周期钩子中执行，而自定义组件是通过继承的方式扩展的，如果直接继承 BaseElement 很容易造成自定义组件扩展在重载方法时忘记调用父类的方法，导致 MIP 对自定义元素失去控制，所以 MIP 提供了一个给开发者自定义元素的 <code>CustomElement</code> 实现类。MIP 的自定义元素基类 <code>CustomElement</code> 基类除了提供规范的定义的几个方法外，还提供了 <code>firstInviewCallback()</code>、<code>viewportCallback()</code> 之类的回调方法，详见 <a href="/v2/guide/component/instance-life-cycle.html">MIP 生命周期</a>。</p><p>在引入 MIP 核心代码之后，在 JS 中我们可以通过如下的方式使用 <code>MIP.registerCustomElement()</code> 方法进行注册一个 MIP 组件：</p><pre><div class="code-index"><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div></div><code class="lang-js">MIP.registerCustomElement(<span class="hljs-string">'mip-drawer'</span>, <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MIP</span>.<span class="hljs-title">CustomElement</span> </span>{
    build() {
        <span class="hljs-keyword">this</span>.element.innerHTML = <span class="hljs-string">'&lt;p&gt;Hello world.&lt;/p&gt;'</span>
    }
})</code></pre><p>注册 MIP 组件 <code>mip-drawer</code> 之后，在 HTML 中就可以直接这样使用新的自定义标签 <code>&lt;mip-drawer&gt;</code>：</p><pre><div class="code-index"><div>1</div></div><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">mip-drawer</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mip-drawer</span>&gt;</span></code></pre><p>MIP 标签在浏览器中渲染后的结果如下所示：</p><pre><div class="code-index"><div>1</div><div>2</div><div>3</div><div>4</div></div><code class="lang-html"><span class="hljs-comment">&lt;!-- mip-drawer 标签上会加一些 mip 相关的 class --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mip-drawer</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mip-element"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Hello world.<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mip-drawer</span>&gt;</span></code></pre><p>从渲染后的结果看，和 Custom Element 一样，最终渲染后的 MIP 标签中已经包含了我们在组件注册中指定的内容。</p><h2 id="在-mip-组件中使用-vue"><a href="#在-mip-组件中使用-vue" class="heading-link"><i class="fa fa-link" aria-hidden="true"></i></a>在 MIP 组件中使用 Vue</h2><p>考虑到 MIP 组件内部的交互逻辑会非常复杂，通过拼接 HTML 的方式构造渲染后的内容过于繁琐，再遇上各种属性绑定，事件处理等问题就更麻烦了，代码也非常不好维护，于是 MIP 又在 Custom Element 的基础上又封装了一层 Vue，可以直接通过写 Vue 组件的方式来写 MIP 组件，MIP 暴露一个 <code>MIP.registerVueCustomElement()</code> 的方法用来注册 Vue 组件为 Custom Element, 用法如下:</p><pre><div class="code-index"><div>1</div></div><code class="lang-js">MIP.registerVueCustomElement(mipTagName, vueCompnentDefinition)</code></pre><p><code>MIP.registerVueCustomElement()</code> 方法包含两个参数，第一个参数，必填，MIP 标签名，必须以 <code>mip-</code> 开头，第二个参数为 Vue 组件定义对象，可以参考 <a data-type="mip" href="https://cn.vuejs.org/v2/guide/instance.html">vue 文档</a></p><p>通过这个接口可以这么写 MIP 组件：</p><pre><div class="code-index"><div>1</div><div>2</div><div>3</div></div><code class="lang-js">MIP.registerVueCustomElement(<span class="hljs-string">'mip-drawer'</span>, {
    <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;p&gt;Hello world.&lt;/p&gt;'</span>
})</code></pre><p>在 HTML 中就可以直接使用 <code>&lt;mip-drawer&gt;</code> 标签：</p><pre><div class="code-index"><div>1</div></div><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">mip-drawer</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mip-drawer</span>&gt;</span></code></pre><p>浏览器渲染后的结果如下：</p><pre><div class="code-index"><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div></div><code class="lang-html"><span class="hljs-comment">&lt;!-- 内部多了一个 div 标签是因为 vue 实例必须要有一个根元素，而自定义标签不能作为 vue 实例的根元素 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mip-drawer</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mip-element"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Hello world.<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mip-drawer</span>&gt;</span></code></pre><p>通过 mip-cli 工具，我们可以使用单文件的方式去开发 MIP 组件，假设我们的 <code>&lt;mip-drawer&gt;</code> 标签对应的 vue 组件文件名为 <code>mip-drawer.,vue</code>，下面是 <code>mip-drawer.vue</code> 文件的代码：</p><pre><div class="code-index"><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div></div><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Hello world.<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    <span class="hljs-comment">// vue 组件定义</span>
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-comment">/* css style*/</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></code></pre><p>通过 mip-cli 工具编译后会将 <code>mip-drawer.vue</code> 文件打包成 <code>mip-drawer.js</code> 文件， 并在构建的 JS 文件中自动通过 <code>MIP.registerVueCustomElement()</code> 方法完成了 vue 组件注册成 MIP 组件自定义元素的工作。</p><p>接下来我们可以看下 <code>MIP.registerVueCustomElement()</code> 方法是如何实现的，下面是精简后的代码。</p><pre><div class="code-index"><div>1</div><div>2</div><div>3</div></div><code class="lang-js">MIP.registerVueCustomElement = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">tag, vueComponent</span>) </span>{
  Vue.customElement(tag, vueComponent)
}</code></pre><p>在 MIP 通过 vue 组件注册一个自定义元素的时候，只是仅仅调用了 <code>Vue.customElement()</code> 方法而已，而 <code>Vue.customElement()</code> 方法的实现代码精简后是如下这样的：</p><pre><div class="code-index"><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div><div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div><div>31</div><div>32</div><div>33</div><div>34</div><div>35</div><div>36</div><div>37</div><div>38</div><div>39</div></div><code class="lang-js">Vue.customElement = <span class="hljs-function">(<span class="hljs-params">tag, componentDefinition</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> props = getProps(componentDefinition)

  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VueCustomElement</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CustomElement</span> </span>{
    <span class="hljs-comment">// 创建 vue 实例</span>
    _build () {
      <span class="hljs-keyword">let</span> vueInstance = <span class="hljs-keyword">this</span>.vueInstance = createVueInstance(
        <span class="hljs-keyword">this</span>.element, {
          Vue
        },
        componentDefinition,
        props
      )
      <span class="hljs-keyword">this</span>.props = props
      <span class="hljs-keyword">this</span>.vm = vueInstance.$children[<span class="hljs-number">0</span>]
    }

    build () {
      <span class="hljs-keyword">this</span>._build()
    }

    <span class="hljs-comment">// 自动绑定自定义标签属性的变化，如果发生变化直接映射到 vue props 属性的变化</span>
    attributeChangedCallback (name, oldValue, value) {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.vueInstance) {
        <span class="hljs-keyword">const</span> nameCamelCase = camelize(name)
        <span class="hljs-keyword">const</span> type = <span class="hljs-keyword">this</span>.props.types[nameCamelCase]
        <span class="hljs-comment">// 会根据 props 定义的 type 对字符串属性值自动解析</span>
        <span class="hljs-keyword">this</span>.vueInstance[nameCamelCase] = convertAttributeValue(value, type)
      }
    }

    <span class="hljs-comment">// 根据 vue 组件定义 props 关联 CustomElement 的 observedAttributes</span>
    <span class="hljs-keyword">static</span> get observedAttributes () {
      <span class="hljs-keyword">return</span> props.hyphenate || []
    }
  }

  registerElement(tag, VueCustomElement)
}</code></pre><p>通过上面的代码，我们可以知道，实际上 vue 实例是在 MIP 组件 build 的回调里创建的，并通过和 Custom Elements 的相关回调钩子传递数据到 vue 实例内部。</p><p>通过以上对 MIP 组件核心源码解析，我们要注意使用 vue 语法写的 MIP 组件需要明确以下几点：</p><ul><li>每个自定元素都创建了一个 vue 实例，只负责渲染自定义元素的内部结构，在 HTML 文档中，MIP 自定义元素跟 vue 是<strong>毫无关系</strong>的。</li><li>MIP 组件定义的自定义元素在 HTML 上完全遵循 HTML 标准，<strong>完全不支持 vue 的语法</strong>，vue 语法只存在组件内部实现。</li><li>组件内部的 vue 组件语法和常规的 vue 语法完全一致。</li></ul><h2 id="使用-vue-组件方式开发的特性"><a href="#使用-vue-组件方式开发的特性" class="heading-link"><i class="fa fa-link" aria-hidden="true"></i></a>使用 vue 组件方式开发的特性</h2><p>虽然在 HTML 语法中不支持 vue 语法，但是 MIP 也提供了很多特性使开发者使用起来更加简单：</p><ul><li>Props 属性传递, 通过 HTML 自定义标签的属性和属性值定义，就可以将自定义标签的属性数据传递给 vue 组件，vue 组件通过 props 属性进行接收。</li><li><a href="/v2/guide/component/slots.html">Slots 内容插槽/分发</a> 可以将 HMTL 自定义元素的内容直接分发到 vue 模板内部的 <code>&lt;slot&gt;</code> 标签</li><li><a href="/v2/guide/component/actions-and-events.html">Events 事件绑定</a>， 可以通过 $emit 和 $on 方法替代 addEventAction 和 eventAction.execute</li><li><a href="/v2/guide/interactive-mip/mip-bind.html">数据绑定</a>，HTML 自定义标签上的属性变化会实时反馈到 vue 内部</li></ul>
    </div>
<div class="markdown-toolbar">
  <a data-type="mip" href="https://github.com/mipengine/mip2/issues/new?title=反馈:docs/guide/component/relationship-between-mip-component-and-vue.md"><span>反馈</span></a>
  <a data-type="mip" href="https://github.com/mipengine/mip2/edit/master/docs/guide/component/relationship-between-mip-component-and-vue.md"><span>编辑</span></a>
</div>
<div class="markdown-paginator">

  <a class="markdown-paginator-item" data-type="mip" href="/v2/guide/component/introduction.html">
    <p class="label">上一页</p>
    <p class="title">MIP 组件化介绍</p>
  </a>
  <a class="markdown-paginator-item" data-type="mip" href="/v2/guide/component/instance-life-cycle.html">
    <p class="label">下一页</p>
    <p class="title">MIP 2.0 组件实例的生命周期和回调钩子</p>
  </a>
</div>
  </div>
</div>
<mip-data>
  <script type="application/json">
    {
      "navbar": [{"name":"首页","path":"docs/index","activeUrl":{},"width":32,"url":"/v2/index.html"},{"name":"学习","width":32,"activeUrl":{},"children":[{"name":"使用文档","path":"docs/guide","width":64,"url":"/v2/guide/basic/newbie.html"},{"name":"组件列表","path":"docs/extensions","width":64,"url":"/v2/components/index.html"},{"name":"API","path":"docs/api","url":"/v2/api/index.html"},{"name":"Codelab","path":"docs/codelabs","width":60,"url":"/v2/codelabs/index.html"}]},{"name":"常用链接","children":[{"name":"MIP 官方博客","url":"http://www.cnblogs.com/mipengine","blank":true},{"name":"MIP-CLI 本地开发工具","url":"https://github.com/mipengine/mip2/tree/master/packages/mip-cli","blank":true},{"name":"MIP 代码校验工具","url":"https://www.mipengine.org/validator/validate","blank":true},{"name":"MIP 效果预览工具","url":"https://www.mipengine.org/validator/preview","blank":true},{"name":"MIP PATH 转换工具","url":"https://www.mipengine.org/mippath.html","blank":true}],"width":82},{"name":"GitHub","url":"https://github.com/mipengine/mip2","blank":true,"width":50},{"name":"回到旧版","url":"https://www.mipengine.org","blank":true,"width":32}],
      "navIndex": "1",
      "sidebarFragment": "guide",
      "sidebarSecondFragment": "guide",
      "menu": [{"name":"简介","path":"docs/guide/basic","children":[{"name":"新手指南","path":"docs/guide/basic/newbie.md","url":"/v2/guide/basic/newbie.html"},{"name":"完整的例子","path":"docs/guide/basic/demo.md","url":"/v2/guide/basic/demo.html"},{"name":"什么是 MIP","path":"docs/guide/basic/what-is-mip.md","url":"/v2/guide/basic/what-is-mip.html"},{"name":"MIP 加速原理","path":"docs/guide/basic/principle-of-mip.md","url":"/v2/guide/basic/principle-of-mip.html"},{"name":"MIP 内容声明","path":"docs/guide/basic/announcement.md","url":"/v2/guide/basic/announcement.html"}]},{"name":"开发规范","path":"docs/guide/mip-standard","children":[{"name":"MIP-HTML 规范","path":"docs/guide/mip-standard/mip-html-spec.md","url":"/v2/guide/mip-standard/mip-html-spec.html"},{"name":"MIP-Cache 规范","path":"docs/guide/mip-standard/mip-cache-spec.md","url":"/v2/guide/mip-standard/mip-cache-spec.html"},{"name":"MIP 校验规则","path":"docs/guide/mip-standard/mip-validate.md","url":"/v2/guide/mip-standard/mip-validate.html"},{"name":"Canonical 使用规范","path":"docs/guide/mip-standard/mip-canonical.md","url":"/v2/guide/mip-standard/mip-canonical.html"},{"name":"组件开发规范","path":"docs/guide/mip-standard/mip-components-spec.md","url":"/v2/guide/mip-standard/mip-components-spec.html"}]},{"name":"MIP 组件机制","path":"docs/guide/component","children":[{"name":"MIP 组件化介绍","path":"docs/guide/component/introduction.md","url":"/v2/guide/component/introduction.html"},{"name":"MIP 组件和 Vue 的关系","path":"docs/guide/component/relationship-between-mip-component-and-vue.md","url":"/v2/guide/component/relationship-between-mip-component-and-vue.html"},{"name":"MIP 2.0 组件实例的生命周期和回调钩子","path":"docs/guide/component/instance-life-cycle.md","url":"/v2/guide/component/instance-life-cycle.html"},{"name":"MIP-HTML 语法和对应 MIP 组件开发介绍","path":"docs/guide/component/syntax.md","url":"/v2/guide/component/syntax.html"},{"name":"插槽","path":"docs/guide/component/slots.md","url":"/v2/guide/component/slots.html"},{"name":"组件布局","path":"docs/guide/component/layout.md","url":"/v2/guide/component/layout.html"},{"name":"沙盒机制","path":"docs/guide/component/sandbox.md","url":"/v2/guide/component/sandbox.html"},{"name":"事件通信","path":"docs/guide/component/actions-and-events.md","url":"/v2/guide/component/actions-and-events.html"},{"name":"组件属性 Props","path":"docs/guide/component/props.md","url":"/v2/guide/component/props.html"}]},{"name":"MIP 组件开发","path":"docs/guide/mip-cli","children":[{"name":"mip2 命令行工具","path":"docs/guide/mip-cli/cli-usage.md","url":"/v2/guide/mip-cli/cli-usage.html"},{"name":"使用 mip-cli 快速开始","path":"docs/guide/mip-cli/start-writing-first-mip.md","url":"/v2/guide/mip-cli/start-writing-first-mip.html"},{"name":"MIP 组件开发","path":"docs/guide/mip-cli/component-development.md","url":"/v2/guide/mip-cli/component-development.html"},{"name":"组件调试","path":"docs/guide/mip-cli/component-testing.md","url":"/v2/guide/mip-cli/component-testing.html"},{"name":"组件部署","path":"docs/guide/mip-cli/component-deploy.md","url":"/v2/guide/mip-cli/component-deploy.html"},{"name":"提交组件到官方组件仓库","path":"docs/guide/mip-cli/contribute-to-official-repo.md","url":"/v2/guide/mip-cli/contribute-to-official-repo.html"},{"name":"提交站长组件","path":"docs/guide/mip-cli/contribute-to-site-extensions-repo.md","url":"/v2/guide/mip-cli/contribute-to-site-extensions-repo.html"},{"name":"mip2 CLI 用户自定义扩展","path":"docs/guide/mip-cli/cli-user-plugin.md","url":"/v2/guide/mip-cli/cli-user-plugin.html"}]},{"name":"进阶教程","path":"docs/guide/mip-advanced","children":[{"name":"MIP 组件间通信","path":"docs/guide/mip-advanced/components-event.md","url":"/v2/guide/mip-advanced/components-event.html"},{"name":"MIP 中与服务端通信","path":"docs/guide/mip-advanced/data-from-server.md","url":"/v2/guide/mip-advanced/data-from-server.html"},{"name":"Promise 在 MIP 中的使用","path":"docs/guide/mip-advanced/promise.md","url":"/v2/guide/mip-advanced/promise.html"},{"name":"MIP 加速原理","path":"docs/guide/mip-advanced/mip-speed-principle.md","url":"/v2/guide/mip-advanced/mip-speed-principle.html"},{"name":"MIP Access 原理剖析","path":"docs/guide/mip-advanced/access-principle.md","url":"/v2/guide/mip-advanced/access-principle.html"},{"name":"离线可用在 MIP 中的实现","path":"docs/guide/mip-advanced/mip-offline.md","url":"/v2/guide/mip-advanced/mip-offline.html"}]},{"name":"MIP 源码解析","path":"docs/guide/mip-source-interpretation","children":[{"name":"MIP 模块简介","path":"docs/guide/mip-source-interpretation/introduction.md","url":"/v2/guide/mip-source-interpretation/introduction.html"},{"name":"MIP 基础模块","path":"docs/guide/mip-source-interpretation/basic.md","url":"/v2/guide/mip-source-interpretation/basic.html"},{"name":"MIP 组件机制详解","path":"docs/guide/mip-source-interpretation/components.md","url":"/v2/guide/mip-source-interpretation/components.html"},{"name":"layout 布局规范","path":"docs/guide/mip-source-interpretation/layout.md","url":"/v2/guide/mip-source-interpretation/layout.html"},{"name":"naboo 动画库","path":"docs/guide/mip-source-interpretation/naboo-animation.md","url":"/v2/guide/mip-source-interpretation/naboo-animation.html"},{"name":"gesture 手势集合","path":"docs/guide/mip-source-interpretation/gesture-sets.md","url":"/v2/guide/mip-source-interpretation/gesture-sets.html"},{"name":"hash 通信机制","path":"docs/guide/mip-source-interpretation/hash.md","url":"/v2/guide/mip-source-interpretation/hash.html"},{"name":"platform 识别","path":"docs/guide/mip-source-interpretation/platform.md","url":"/v2/guide/mip-source-interpretation/platform.html"}]},{"name":"可交互 MIP","path":"docs/guide/interactive-mip","children":[{"name":"可交互 MIP - 概况","path":"docs/guide/interactive-mip/introduction.md","url":"/v2/guide/interactive-mip/introduction.html"},{"name":"mip-data 设置数据","path":"docs/guide/interactive-mip/mip-data.md","url":"/v2/guide/interactive-mip/mip-data.html"},{"name":"mip-bind 绑定数据","path":"docs/guide/interactive-mip/mip-bind.md","url":"/v2/guide/interactive-mip/mip-bind.html"},{"name":"Class 与 Style 绑定","path":"docs/guide/interactive-mip/class-style-binding.md","url":"/v2/guide/interactive-mip/class-style-binding.html"},{"name":"MIP.setData 修改数据","path":"docs/guide/interactive-mip/set-data.md","url":"/v2/guide/interactive-mip/set-data.html"},{"name":"MIP.watch 观察数据","path":"docs/guide/interactive-mip/watch.md","url":"/v2/guide/interactive-mip/watch.html"},{"name":"全局共享数据","path":"docs/guide/interactive-mip/global-data.md","url":"/v2/guide/interactive-mip/global-data.html"},{"name":"mip-script 自定义 JS","path":"docs/guide/interactive-mip/mip-script.md","url":"/v2/guide/interactive-mip/mip-script.html"}]},{"name":"全站 MIP","path":"docs/guide/all-sites-mip","children":[{"name":"全站 MIP 介绍","path":"docs/guide/all-sites-mip/introduction.md","url":"/v2/guide/all-sites-mip/introduction.html"},{"name":"MIP 页面编写规范","path":"docs/guide/all-sites-mip/structure.md","url":"/v2/guide/all-sites-mip/structure.html"},{"name":"页面切换方案","path":"docs/guide/all-sites-mip/switch-page.md","url":"/v2/guide/all-sites-mip/switch-page.html"},{"name":"Page API","path":"docs/guide/all-sites-mip/page-api.md","url":"/v2/guide/all-sites-mip/page-api.html"},{"name":"MIP Shell","path":"docs/guide/all-sites-mip/mip-shell.md","url":"/v2/guide/all-sites-mip/mip-shell.html"},{"name":"MIP Viewer","path":"docs/guide/all-sites-mip/viewer.md","url":"/v2/guide/all-sites-mip/viewer.html"},{"name":"MIP 快捷样式","path":"docs/guide/all-sites-mip/style.md","url":"/v2/guide/all-sites-mip/style.html"}]},{"name":"MIP 搜索生效","path":"docs/guide/mip-in-search","children":[{"name":"搜索识别 MIP 页","path":"docs/guide/mip-in-search/introduction.md","url":"/v2/guide/mip-in-search/introduction.html"},{"name":"MIP 搜索生效流程","path":"docs/guide/mip-in-search/process.md","url":"/v2/guide/mip-in-search/process.html"},{"name":"MIP-Cache","path":"docs/guide/mip-in-search/mip-cache.md","url":"/v2/guide/mip-in-search/mip-cache.html"},{"name":"类原生的 MIP 页面体验","path":"docs/guide/mip-in-search/native-like-mip.md","url":"/v2/guide/mip-in-search/native-like-mip.html"}]}],
      "chapters": [{"level":1,"hash":"#mip-组件和-vue-的关系","text":"MIP 组件和 Vue 的关系","children":[{"level":2,"hash":"#定义自定义元素","text":"定义自定义元素"},{"level":2,"hash":"#mip-组件","text":"MIP 组件"},{"level":2,"hash":"#在-mip-组件中使用-vue","text":"在 MIP 组件中使用 Vue"},{"level":2,"hash":"#使用-vue-组件方式开发的特性","text":"使用 vue 组件方式开发的特性"}]}],
      'url': "/v2/guide/component/relationship-between-mip-component-and-vue.html"
    }
  </script>
</mip-data>

    <!-- <script src="http://172.18.19.102:8080/dist/mip.js"></script> -->
    <script src="https://c.mipcdn.com/static/v2/mip.js"></script>
    <!-- <script src="https://bos.nj.bpc.baidu.com/assets/mip/projects/mip.js"></script> -->
    <!-- <script src="http://127.0.0.1:8111/mip-sidenav/mip-sidenav.js"></script> -->
    <script src="https://bos.nj.bpc.baidu.com/assets/mip/temp/mip-sidenav.js?v=194253"></script>
    <script src="https://bos.nj.bpc.baidu.com/assets/mip/codelab/mip-stepper-tabs.js"></script>
<!--     <script src="http://127.0.0.1:8111/mip-stepper-tabs/mip-stepper-tabs.js"></script> -->
    <!-- <script src="https://c.mipcdn.com/static/v1/mip-fixed/mip-fixed.js"></script> -->
    <script src="https://c.mipcdn.com/static/v1/mip-sidebar/mip-sidebar.js"></script>
    <script src="https://c.mipcdn.com/static/v1/mip-showmore/mip-showmore.js"></script>
    <script src="https://c.mipcdn.com/static/v1/mip-toggle/mip-toggle.js"></script>
  </body>
</html>
